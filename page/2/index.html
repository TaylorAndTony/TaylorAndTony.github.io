<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords"><meta name="author" content="TaylorAndTony,undefined"><meta name="copyright" content="TaylorAndTony"><title>【Hexo】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- script(src=url_for("/js/mathjax/mathjax.js"))--><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"2J9NCG4VA1","apiKey":"e2286fef4db1fed3731c0afa0c68d9ed","indexName":"hexo","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: {},
  valine: {},
  twikoo: {},
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="author-info"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">TaylorAndTony</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/TaylorAndTony" target="_blank">GitHub<i class="icon-dot bg-color8"></i></a><a class="links-button button-hover" href="mailto:doyijian@163.com" target="_blank">E-Mail<i class="icon-dot bg-color10"></i></a><a class="links-button button-hover" href="https://space.bilibili.com/47256272" target="_blank">Bilibili<i class="icon-dot bg-color4"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">38</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">56</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">11</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">Hexo</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><div id="recent-posts"><!-- each post in page.posts.sort('date', -1).limit(10).toArray()--><!-- config中配置按照什么排序--><div class="recent-post-item"><a class="post-title" href="/2025/01/31/linux-Ubuntu%E5%AE%89%E8%A3%85%E6%90%9C%E7%8B%97%E8%BE%93%E5%85%A5%E6%B3%95/">Ubuntu安装搜狗输入法</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-31</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/linux/">linux</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/software/">software</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/ubuntu/">ubuntu</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/linux/">linux</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Ubuntu-安装搜狗输入法"><a href="#Ubuntu-安装搜狗输入法" class="headerlink" title="Ubuntu 安装搜狗输入法"></a>Ubuntu 安装搜狗输入法</h1><blockquote>
<p>本文图片来自搜狗官网</p>
</blockquote>
<p>搜狗官网指南：<a target="_blank" rel="noopener" href="https://pinyin.sogou.com/linux/help.php">搜狗输入法 for linux 安装指南 (sogou.com)</a></p>
<h2 id="1、更新源"><a href="#1、更新源" class="headerlink" title="1、更新源"></a>1、更新源</h2><p>在终端执行 sudo apt update</p>
<h2 id="2、安装fcitx输入法框架"><a href="#2、安装fcitx输入法框架" class="headerlink" title="2、安装fcitx输入法框架"></a>2、安装fcitx输入法框架</h2><ol>
<li><p>在终端输入 <code>sudo apt install fcitx</code></p>
</li>
<li><p>设置fcitx为系统输入法</p>
</li>
</ol>
<p>点击左下角菜单选择语言支持，将语言选择为fcitx</p>
<p><img src="https://pinyin.sogou.com/linux/images/help8.png" alt="img"></p>
<ol start="3">
<li>设置fcitx开机自启动</li>
</ol>
<p>在终端执行<code>sudo cp /usr/share/applications/fcitx.desktop /etc/xdg/autostart/</code></p>
<ol start="4">
<li>卸载系统ibus输入法框架</li>
</ol>
<p>在终端执行 <code>sudo apt purge ibus</code></p>
<h2 id="3、安装搜狗输入法"><a href="#3、安装搜狗输入法" class="headerlink" title="3、安装搜狗输入法"></a>3、安装搜狗输入法</h2><ol>
<li><p>在官网下载搜狗输入法安装包，并安装，安装命令 sudo dpkg -i 安装包名</p>
</li>
<li><p>安装输入法依赖</p>
</li>
</ol>
<p>在终端执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libqt5qml5 libqt5quick5 libqt5quickwidgets5 qml-module-qtquick2</span><br><span class="line"></span><br><span class="line">sudo apt install libgsettings-qt1</span><br></pre></td></tr></table></figure>

<p><img src="https://pinyin.sogou.com/linux/images/help12.png" alt="img"></p>
<h2 id="4、重启电脑、调出输入法"><a href="#4、重启电脑、调出输入法" class="headerlink" title="4、重启电脑、调出输入法"></a>4、重启电脑、调出输入法</h2><p>1.重启电脑</p>
<p>2.查看右上角，可以看到“搜狗”字样，在输入窗口即可且出搜狗输入法。</p>
<p><img src="https://pinyin.sogou.com/linux/images/help13.png" alt="img"></p>
<ol start="3">
<li>没有“搜狗”字样，选择配置，将搜狗加入输入法列表即可</li>
</ol>
<p><img src="https://pinyin.sogou.com/linux/images/help14.png" alt="img"></p>
<p><img src="https://pinyin.sogou.com/linux/images/help15.png" alt="img"></p>
<p>至此，搜狗输入法安装完毕</p>
<p><img src="https://pinyin.sogou.com/linux/images/help16.png" alt="img"></p>
</div></div><a class="button-hover more" href="/2025/01/31/linux-Ubuntu%E5%AE%89%E8%A3%85%E6%90%9C%E7%8B%97%E8%BE%93%E5%85%A5%E6%B3%95/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/31/linux-Ubuntu%E5%BF%AB%E9%80%9F%E6%B8%A9%E9%A5%B1%E6%8C%87%E5%8D%97/">Ubuntu 快速开始配置</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-31</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/linux/">linux</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/ubuntu/">ubuntu</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/linux/">linux</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/dev/">dev</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Ubuntu-快速开始配置"><a href="#Ubuntu-快速开始配置" class="headerlink" title="Ubuntu 快速开始配置"></a>Ubuntu 快速开始配置</h1><h2 id="换源"><a href="#换源" class="headerlink" title="[换源]"></a>[换源]</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#添加阿里源</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">#添加清华源</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse multiverse</span><br></pre></td></tr></table></figure>

<p>#更新源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<h2 id="Alias"><a href="#Alias" class="headerlink" title="Alias"></a>Alias</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alias sai=&#x27;sudo apt install&#x27;</span><br><span class="line">alias ll=&#x27;ls -al&#x27;</span><br><span class="line"></span><br><span class="line">echo &quot;sai=&#x27;sudo apt install&#x27;&quot; &gt;&gt; ~/.zshrc</span><br><span class="line">echo &quot;ll=&#x27;ls -al&#x27;&quot; &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure>

<h2 id="常用软件"><a href="#常用软件" class="headerlink" title="[常用软件]"></a>[常用软件]</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install net-tools</span><br><span class="line">sudo apt-get install curl git htop screen tmux</span><br><span class="line">sudo apt-get install python3-dev python3-pip python3-setuptools</span><br><span class="line">sudo apt-get install ffmpeg</span><br></pre></td></tr></table></figure>

<h2 id="pip-换源"><a href="#pip-换源" class="headerlink" title="[pip 换源]"></a>[pip 换源]</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建pip文件夹</span></span><br><span class="line">sudo mkdir pip</span><br><span class="line">cd pip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建pip.cong文件</span></span><br><span class="line">touch pip.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编辑pip.conf文件</span></span><br><span class="line">sudo vim pip.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">写入</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">index-url</span> = https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>

<h2 id="pip"><a href="#pip" class="headerlink" title="[pip]"></a>[pip]</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip</span><br><span class="line">pip install requests icecream rich</span><br></pre></td></tr></table></figure>


<h2 id="SSH"><a href="#SSH" class="headerlink" title="[SSH]"></a>[SSH]</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br><span class="line">sudo systemctl enable ssh</span><br></pre></td></tr></table></figure>

<h2 id="Docker"><a href="#Docker" class="headerlink" title="[Docker]"></a>[Docker]</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure>

<h2 id="zsh"><a href="#zsh" class="headerlink" title="[zsh]"></a>[zsh]</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zsh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入 zsh</span></span><br><span class="line">zsh</span><br><span class="line"></span><br><span class="line">sh -c &quot;$(wget https://gitee.com/mirrors/oh-my-zsh/raw/master/tools/install.sh -O -)&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法高亮</span></span><br><span class="line">sudo apt install zsh-syntax-highlighting</span><br><span class="line">echo &quot;source /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh&quot; &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">自动补全</span></span><br><span class="line">git clone https://gitee.com/mattuy/zsh-autosuggestions.git $ZSH_CUSTOM/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure>

<p>然后修改 ~&#x2F;.zshrc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plugins=( </span><br><span class="line">    zsh-autosuggestions</span><br><span class="line">    z</span><br><span class="line">    extract</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="thefuck"><a href="#thefuck" class="headerlink" title="thefuck"></a>thefuck</h2><p><code>thefuck</code> 是一个用于 Linux 和其他 Unix 类操作系统（包括 macOS）的命令行工具，它旨在帮助用户纠正他们输入错误的命令。当你在终端中输入了一个命令但拼写错误或使用了不正确的参数时，thefuck 可以自动识别并提供修正建议，只需再次运行该命令（通常通过简单地输入 fuck 并按下回车键），即可自动更正并重新执行你的命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install thefuck</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>把下面的加入.bashrc</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eval $(thefuck --alias)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">You can use whatever you want as an <span class="built_in">alias</span>, like <span class="keyword">for</span> Mondays:</span></span><br><span class="line">eval $(thefuck --alias FUCK)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者继续添加下面这句，启用自动确认</span></span><br><span class="line">alias fuck=&#x27;fuck -y&#x27;</span><br></pre></td></tr></table></figure></div></div><a class="button-hover more" href="/2025/01/31/linux-Ubuntu%E5%BF%AB%E9%80%9F%E6%B8%A9%E9%A5%B1%E6%8C%87%E5%8D%97/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/31/soft-nm3u8/">使用 N_m3u8 的 m3u8dl 协议</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-31</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/software/">software</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/m3u8/">m3u8</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/nm3u8dl/">nm3u8dl</a></div></div><div class="post-content"><div class="main-content content"><h1 id="使用-N-m3u8-的-m3u8dl-协议"><a href="#使用-N-m3u8-的-m3u8dl-协议" class="headerlink" title="使用 N_m3u8 的 m3u8dl 协议"></a>使用 N_m3u8 的 m3u8dl 协议</h1><p>N_m3u8DL-CLI 是一个非常优秀的第三方 m3u8 文件合并下载工具。</p>
<p>下载 [N_m3u8DL-CLI](<a target="_blank" rel="noopener" href="https://github.com/nilaoda/N_m3u8DL-CLI/releases">Releases · nilaoda&#x2F;N_m3u8DL-CLI (github.com)</a>)</p>
<p>解压后 建议 N_m3u8DL-CLI_v3.0.*.exe <strong>重命名为 m3u8dl.exe 或其他固定名称</strong>。否则每次更新版本都需要重新注册协议，以后更新 N_m3u8DL-CLI 只需修改文件名替换即可。</p>
<p><strong>以后每次调用协议下载，都是下载到注册此 exe 所在的文件夹</strong></p>
<p>使用cmd 运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m3u8dl.exe --registerUrlProtocol</span><br></pre></td></tr></table></figure>

<p>检查是否完成，在浏览器地址栏输入 <code>m3u8dl:// </code>回车 是否有如下对话框</p>
<p><img src="https://pic1.imgdb.cn/item/679c2db2d0e0a243d4f8b9a8.png" alt="img"></p>
<p>看到此窗口，恭喜你已经完成了m3u8dl:&#x2F;&#x2F;协议的注册，之后在猫抓设置，开启 调用m3u8dl:&#x2F;&#x2F;协议下载m3u8 和 mpd 选项，你可以自定义修改调用参数，点击 查看参数说明 按钮查看所有参数列表。</p>
<p>如果猫抓嗅探到m3u8或mpd文件的存在，popup页面直接点击文件的下载按钮会直接调用N_m3u8DL-CLI下载</p>
</div></div><a class="button-hover more" href="/2025/01/31/soft-nm3u8/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/26/csharp-parse-toml/">C# 解析 TOML</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-31</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/csharp/">csharp</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/csharp/">csharp</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/toml/">toml</a></div></div><div class="post-content"><div class="main-content content"><h1 id="C-解析-TOML"><a href="#C-解析-TOML" class="headerlink" title="C# 解析 TOML"></a>C# 解析 TOML</h1><h2 id="Tomlyn-库"><a href="#Tomlyn-库" class="headerlink" title="Tomlyn 库"></a>Tomlyn 库</h2><p><a target="_blank" rel="noopener" href="https://github.com/xoofx/Tomlyn">xoofx&#x2F;Tomlyn: Tomlyn is a TOML parser, validator and authoring library for .NET Framework and .NET Core (github.com)</a></p>
<h3 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> toml = <span class="string">@&quot;global = &quot;&quot;this is a string&quot;&quot;</span></span><br><span class="line"><span class="string"># This is a comment of a table</span></span><br><span class="line"><span class="string">[my_table]</span></span><br><span class="line"><span class="string">key = 1 # Comment a key</span></span><br><span class="line"><span class="string">value = true</span></span><br><span class="line"><span class="string">list = [4, 5, 6]</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parse the TOML string to the default runtime model `TomlTable`</span></span><br><span class="line"><span class="keyword">var</span> model = Toml.ToModel(toml);</span><br><span class="line"><span class="comment">// Fetch the string</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">global</span> = (<span class="built_in">string</span>)model[<span class="string">&quot;global&quot;</span>]!;</span><br><span class="line"><span class="comment">// Prints: found global = &quot;this is a string&quot;</span></span><br><span class="line">Console.WriteLine(<span class="string">$&quot;found global = \&quot;<span class="subst">&#123;<span class="keyword">global</span>&#125;</span>\&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="解析列表"><a href="#解析列表" class="headerlink" title="解析列表"></a>解析列表</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[[path]]</span></span><br><span class="line"><span class="attr">src</span> = <span class="string">&#x27;E:\# Ultra File Folder&#x27;</span></span><br><span class="line"><span class="attr">dst</span> = <span class="string">&#x27;$:\# Ultra File Folder&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[path]]</span></span><br><span class="line"><span class="attr">src</span> = <span class="string">&#x27;E:\# Ultra File Folder 2133&#x27;</span></span><br><span class="line"><span class="attr">dst</span> = <span class="string">&#x27;$:\# Ultra File Folder 23123&#x27;</span></span><br></pre></td></tr></table></figure>

<p>解析：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Tomlyn.Model.TomlTable model;</span><br><span class="line"></span><br><span class="line">model = Toml.ToModel(File.ReadAllText(...));</span><br><span class="line"></span><br><span class="line">Tomlyn.Model.TomlTableArray paths = (Tomlyn.Model.TomlTableArray)model[<span class="string">&quot;path&quot;</span>]!;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(Tomlyn.Model.TomlTable m <span class="keyword">in</span> paths)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// do sth...</span></span><br><span class="line">    <span class="comment">// extract vars</span></span><br><span class="line">    <span class="built_in">string</span> src, dst, cmd;</span><br><span class="line">    <span class="built_in">bool</span> enableNorm, enableBack;</span><br><span class="line">    <span class="comment">// read vars</span></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        src = (<span class="built_in">string</span>)(reverseDirection ? m[<span class="string">&quot;dst&quot;</span>] : m[<span class="string">&quot;src&quot;</span>]);</span><br><span class="line">        dst = (<span class="built_in">string</span>)(reverseDirection ? m[<span class="string">&quot;src&quot;</span>] : m[<span class="string">&quot;dst&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(ex.Message);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解析到类"><a href="#解析到类" class="headerlink" title="解析到类"></a>解析到类</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TomlModel <span class="title">Parse</span>(<span class="params"><span class="built_in">string</span> toml</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> model = Toml.ToModel&lt;TomlModel&gt;(toml);</span><br><span class="line">    <span class="keyword">return</span> model;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div><a class="button-hover more" href="/2025/01/26/csharp-parse-toml/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/26/asp-net-upload-file/">ASP.NET 最小 WebAPI 上传文件</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-26</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/csharp/">csharp</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/csharp/">csharp</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/asp-net/">asp.net</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/microsoft/">microsoft</a></div></div><div class="post-content"><div class="main-content content"><h1 id="ASP-NET-最小-WebAPI-上传文件"><a href="#ASP-NET-最小-WebAPI-上传文件" class="headerlink" title="ASP.NET 最小 WebAPI 上传文件"></a>ASP.NET 最小 WebAPI 上传文件</h1><h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// accept upload image file</span></span><br><span class="line">app.MapPost(<span class="string">&quot;/api/upload-img/&#123;id&#125;&quot;</span>, <span class="function"><span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">IResult</span>&gt; (<span class="params"><span class="built_in">int</span> id, HttpRequest request</span>)</span> =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    Log.Information(<span class="string">&quot;Upload image request for id: &#123;0&#125;&quot;</span>, id);</span><br><span class="line">    <span class="keyword">if</span> (!loginManager.IsLogin(request.HttpContext.GetIpAddress()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Results.Json(<span class="keyword">new</span> ServerAckDash()</span><br><span class="line">        &#123;</span><br><span class="line">            Success = <span class="literal">false</span>,</span><br><span class="line">            Message = <span class="string">&quot;Not logged in&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!request.HasFormContentType)</span><br><span class="line">        <span class="keyword">return</span> Results.Json(<span class="keyword">new</span> ServerAckDash()</span><br><span class="line">        &#123;</span><br><span class="line">            Success = <span class="literal">false</span>,</span><br><span class="line">            Message = <span class="string">&quot;Invalid content type&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> form = <span class="keyword">await</span> request.ReadFormAsync();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (form.Files.Any() == <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span> Results.Json(<span class="keyword">new</span> ServerAckDash()</span><br><span class="line">        &#123;</span><br><span class="line">            Success = <span class="literal">false</span>,</span><br><span class="line">            Message = <span class="string">&quot;No file found&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">file</span> = form.Files.FirstOrDefault();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">file</span> <span class="keyword">is</span> <span class="literal">null</span> || <span class="keyword">file</span>.Length == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> Results.Json(<span class="keyword">new</span> ServerAckDash()</span><br><span class="line">        &#123;</span><br><span class="line">            Success = <span class="literal">false</span>,</span><br><span class="line">            Message = <span class="string">&quot;No file found&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">var</span> stream = <span class="keyword">file</span>.OpenReadStream();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// read image data</span></span><br><span class="line">    <span class="built_in">byte</span>[] data = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="keyword">file</span>.Length];</span><br><span class="line">    <span class="keyword">await</span> stream.ReadAsync(data, <span class="number">0</span>, (<span class="built_in">int</span>)<span class="keyword">file</span>.Length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save image to file</span></span><br><span class="line">    <span class="keyword">var</span> fileName = <span class="keyword">file</span>.FileName;</span><br><span class="line">    Log.Information(<span class="string">&quot;Image file name: &#123;0&#125;&quot;</span>, fileName);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> storePath = Path.Combine(Directory.GetCurrentDirectory(), <span class="string">&quot;wwwroot&quot;</span>, <span class="string">&quot;customImg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!Directory.Exists(storePath))</span><br><span class="line">    &#123;</span><br><span class="line">        Directory.CreateDirectory(storePath);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> filePath = Path.Combine(storePath, fileName);</span><br><span class="line">    </span><br><span class="line">    Log.Information(<span class="string">&quot;Image will be write to &#123;0&#125;&quot;</span>, filePath);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (File.Exists(filePath))</span><br><span class="line">    &#123;</span><br><span class="line">        File.Delete(filePath);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">var</span> fileStream = <span class="keyword">new</span> FileStream(filePath, FileMode.Create);</span><br><span class="line">    <span class="keyword">await</span> fileStream.WriteAsync(data, <span class="number">0</span>, data.Length);</span><br><span class="line">    fileStream.Close();</span><br><span class="line">    <span class="keyword">return</span> Results.Json(<span class="keyword">new</span> ServerAckDash()</span><br><span class="line">    &#123;</span><br><span class="line">        Success = <span class="literal">true</span>,</span><br><span class="line">        Message = <span class="string">&quot;Image uploaded&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).Accepts&lt;IFormFile&gt;(<span class="string">&quot;multipart/form-data&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">uploadImage</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    <span class="keyword">const</span> fileInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;bg-input&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> file = fileInput.<span class="property">files</span>[<span class="number">0</span>]; <span class="comment">// 获取选中的文件</span></span><br><span class="line">    formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file); <span class="comment">// 将文件添加到FormData对象中</span></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;/api/upload-img/&#x27;</span> + id, &#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="attr">body</span>: formData <span class="comment">// 设置请求体为FormData对象</span></span><br><span class="line">    &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="property">success</span>) &#123;</span><br><span class="line">            <span class="title class_">Swal</span>.<span class="title function_">fire</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;Image uploaded!&#x27;</span>, <span class="attr">text</span>: data.<span class="property">message</span> &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title class_">Swal</span>.<span class="title function_">fire</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;Image upload failed!&#x27;</span>, <span class="attr">text</span>: data.<span class="property">message</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error));</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

</div></div><a class="button-hover more" href="/2025/01/26/asp-net-upload-file/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/26/blazor-add-api/">ASP.NET Blazor 添加 WebAPI 支持</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-26</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/csharp/">csharp</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/csharp/">csharp</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/asp-net/">asp.net</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/blazor/">blazor</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/web/">web</a></div></div><div class="post-content"><div class="main-content content"><h1 id="ASP-NET-Blazor-添加-WebAPI-支持"><a href="#ASP-NET-Blazor-添加-WebAPI-支持" class="headerlink" title="ASP.NET Blazor 添加 WebAPI 支持"></a>ASP.NET Blazor 添加 WebAPI 支持</h1><h2 id="Program-cs"><a href="#Program-cs" class="headerlink" title="Program.cs"></a>Program.cs</h2><p>添加服务</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builder.Services.AddControllers();</span><br></pre></td></tr></table></figure>

<p>添加控制器</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add support for web api</span></span><br><span class="line">app.MapControllers();</span><br></pre></td></tr></table></figure>

<p>Program.cs 完整代码</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> BlazorApiTest.Components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(<span class="keyword">args</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add services to the container.</span></span><br><span class="line">builder.Services.AddRazorComponents()</span><br><span class="line">    .AddInteractiveServerComponents();</span><br><span class="line"></span><br><span class="line"><span class="comment">// add support for web api</span></span><br><span class="line">builder.Services.AddControllers();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Configure the HTTP request pipeline.</span></span><br><span class="line"><span class="keyword">if</span> (!app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseExceptionHandler(<span class="string">&quot;/Error&quot;</span>, createScopeForErrors: <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.UseStaticFiles();</span><br><span class="line">app.UseAntiforgery();</span><br><span class="line"></span><br><span class="line">app.MapRazorComponents&lt;App&gt;()</span><br><span class="line">    .AddInteractiveServerRenderMode();</span><br><span class="line"></span><br><span class="line"><span class="comment">// add support for web api</span></span><br><span class="line">app.MapControllers();</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>



<h2 id="编写控制器"><a href="#编写控制器" class="headerlink" title="编写控制器"></a>编写控制器</h2><p>创建 <code>Controllers/BasicController.cs</code> 名称任意</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">BlazorApiTest.Controllers</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;api/&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BasicController</span>: <span class="title">Controller</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">HttpGet(<span class="string">&quot;test&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Get</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动程序访问 <code>/api/test</code> 即可看到正确回显 <code>Hello, World!</code></p>
<p>或者，使用约定的路由方法</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">BlazorApiTest.Controllers</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;api/[controller]/[action]&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BasicController</span>: <span class="title">Controller</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Hello</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, World! From Hello() method&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Goodbye</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Goodbye, World! From Goodbye() method&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，访问 <code>/api/Basic/Hello</code> 和 <code>/api/Basic/Goodbye</code> 可看到对应的输出</p>
</div></div><a class="button-hover more" href="/2025/01/26/blazor-add-api/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/25/windows-delete-file-err/">Win10 删除文件显示找不到该项目</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-25</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/software/">software</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/microsoft/">microsoft</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/troubleshoot/">troubleshoot</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/windows/">windows</a></div></div><div class="post-content"><div class="main-content content"><h1 id="Win10-删除一个文件显示找不到该项目"><a href="#Win10-删除一个文件显示找不到该项目" class="headerlink" title="Win10 删除一个文件显示找不到该项目"></a>Win10 删除一个文件显示<code>找不到该项目</code></h1><p>现象：在 explorer 中，选中一个文件，按下 <code>Shift+Delete</code>，弹窗提示<code>找不到该项目</code>。在此目录下使用 <code>dir</code> 命令，可以看到文件存在。</p>
<h2 id="用批处理"><a href="#用批处理" class="headerlink" title="用批处理"></a>用批处理</h2><p>打开空白文档，输入以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DEL /F /A /Q \\?\%1</span><br><span class="line">RD /S /Q \\?\%1</span><br></pre></td></tr></table></figure>

<p>将文本文档另存为 .bat 文件</p>
<p>将需要删除的文件夹拖拽到 bat 批处理文件上即可完成删除</p>
<h2 id="用git-bash"><a href="#用git-bash" class="headerlink" title="用git bash"></a>用git bash</h2><p>输入命令 <code>rm -rf 文件名</code></p>
<h2 id="放文件"><a href="#放文件" class="headerlink" title="放文件"></a>放文件</h2><p>在文件夹内放一个文件，再删除文件夹</p>
</div></div><a class="button-hover more" href="/2025/01/25/windows-delete-file-err/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/25/csharp-open-url/">C# 打开网址</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-25</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/csharp/">csharp</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/csharp/">csharp</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/microsoft/">microsoft</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/dotnet/">dotnet</a></div></div><div class="post-content"><div class="main-content content"><h1 id="C-打开网址-Process-Start-for-URLs-txt"><a href="#C-打开网址-Process-Start-for-URLs-txt" class="headerlink" title="C# 打开网址 Process Start for URLs.txt"></a>C# 打开网址 Process Start for URLs.txt</h1><p>Apparently .NET Core is sort of broken when it comes to opening a URL via <code>Process.Start</code>. Normally you’d expect to do this:</p>
<p><code>Process.Start(&quot;http://google.com&quot;)</code><br>And then the default system browser pops open and you’re good to go. But this open issue explains that this doesn’t work on .NET Core. So instead you have to do this (credit goes to Eric Mellino):</p>
<h2 id="solution-1-tested"><a href="#solution-1-tested" class="headerlink" title="solution 1 (tested)"></a>solution 1 (tested)</h2><p>use simple one</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Process.Start(<span class="keyword">new</span> ProcessStartInfo() </span><br><span class="line">              &#123;</span><br><span class="line">                  FileName = <span class="string">&quot;cmd&quot;</span>,</span><br><span class="line">                  Arguments = <span class="string">&quot;/c start &quot;</span> + url,</span><br><span class="line">                  UseShellExecute = <span class="literal">false</span>,</span><br><span class="line">                  WindowStyle = ProcessWindowStyle.Hidden,</span><br><span class="line">                  CreateNoWindow = <span class="literal">true</span>,</span><br><span class="line">              &#125;);</span><br></pre></td></tr></table></figure>

<p>or the long one</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenBrowser</span>(<span class="params"><span class="built_in">string</span> url</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        Process.Start(url);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// hack because of this: https://github.com/dotnet/corefx/issues/10361</span></span><br><span class="line">        <span class="keyword">if</span> (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))</span><br><span class="line">        &#123;</span><br><span class="line">            url = url.Replace(<span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;^&amp;&quot;</span>);</span><br><span class="line">            Process.Start(<span class="keyword">new</span> ProcessStartInfo(<span class="string">&quot;cmd&quot;</span>, <span class="string">$&quot;/c start <span class="subst">&#123;url&#125;</span>&quot;</span>) &#123; CreateNoWindow = <span class="literal">true</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RuntimeInformation.IsOSPlatform(OSPlatform.Linux))</span><br><span class="line">        &#123;</span><br><span class="line">            Process.Start(<span class="string">&quot;xdg-open&quot;</span>, url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (RuntimeInformation.IsOSPlatform(OSPlatform.OSX))</span><br><span class="line">        &#123;</span><br><span class="line">            Process.Start(<span class="string">&quot;open&quot;</span>, url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="solution-2-tested"><a href="#solution-2-tested" class="headerlink" title="solution 2 (tested)"></a>solution 2 (tested)</h2><p>This was an intentional breaking change in .Net Core. Specifically, <code>UseShellExecute</code>, which is required to be <code>true</code> for your code to work, <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.processstartinfo.useshellexecute">defaults to <code>true</code> on .Net Framework, but it’s <code>false</code> on .Net Core</a>. This means the following code will work on both frameworks:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Process.Start(<span class="keyword">new</span> ProcessStartInfo(<span class="string">&quot;https://www.google.com&quot;</span>) &#123; UseShellExecute = <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="solution-3"><a href="#solution-3" class="headerlink" title="solution 3"></a>solution 3</h2><p><strong><a target="_blank" rel="noopener" href="https://github.com/dsplaisted">dsplaisted</a></strong> commented <a target="_blank" rel="noopener" href="https://github.com/dotnet/runtime/issues/28005#issuecomment-442214248">on Nov 28, 2018</a></p>
<p>I believe the currently recommended workaround is to set <code>UseShellExecute</code> to true:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ProcessStartInfo psi = <span class="keyword">new</span> ProcessStartInfo</span><br><span class="line">&#123;</span><br><span class="line">    FileName = url,</span><br><span class="line">    UseShellExecute = <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line">Process.Start (psi);</span><br></pre></td></tr></table></figure>

<p><strong><a target="_blank" rel="noopener" href="https://github.com/clairernovotny">clairernovotny</a></strong> commented <a target="_blank" rel="noopener" href="https://github.com/dotnet/runtime/issues/28005#issuecomment-442214640">on Nov 28, 2018</a> • edited </p>
<p>You need this instead</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ProcessStartInfo psi = <span class="keyword">new</span> ProcessStartInfo</span><br><span class="line">&#123;</span><br><span class="line">    FileName = <span class="string">&quot;cmd&quot;</span>,</span><br><span class="line">    Arguments = <span class="string">&quot;/c start https://www.baidu.com/s?wd=beijing%20time&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">Process.Start(psi);</span><br></pre></td></tr></table></figure>

<p>Which is ugly…and more likely to bite people, I think.</p>
<p><strong><a target="_blank" rel="noopener" href="https://github.com/clairernovotny">clairernovotny</a></strong> commented <a target="_blank" rel="noopener" href="https://github.com/dotnet/runtime/issues/28005#issuecomment-442217271">on Nov 28, 2018</a></p>
<p>Actually it’s worse than that, here’s what you need to do it right <strong>so no cmd window appears</strong>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> psi = <span class="keyword">new</span> ProcessStartInfo</span><br><span class="line">&#123;</span><br><span class="line">    FileName = <span class="string">&quot;cmd&quot;</span>,</span><br><span class="line">    WindowStyle = ProcessWindowStyle.Hidden,</span><br><span class="line">    UseShellExecute = <span class="literal">false</span>,</span><br><span class="line">    CreateNoWindow = <span class="literal">true</span>,</span><br><span class="line">    Arguments = <span class="string">$&quot;/c start <span class="subst">&#123;link.AbsoluteUri&#125;</span>&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line">Process.Start(psi);</span><br></pre></td></tr></table></figure>

</div></div><a class="button-hover more" href="/2025/01/25/csharp-open-url/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/25/csharp-images/">C# bitmap 图片编码及压缩参数</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-25</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/csharp/">csharp</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/csharp/">csharp</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/microsoft/">microsoft</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/dotnet/">dotnet</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/cv/">cv</a></div></div><div class="post-content"><div class="main-content content"><h1 id="C-bitmap图片编码及压缩参数"><a href="#C-bitmap图片编码及压缩参数" class="headerlink" title="C# bitmap图片编码及压缩参数"></a>C# bitmap图片编码及压缩参数</h1><h2 id="读取图片"><a href="#读取图片" class="headerlink" title="读取图片"></a>读取图片</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Image img = Image.FromFile(imgFile);</span><br></pre></td></tr></table></figure>

<h2 id="ImageCodecInfo-帮助方法"><a href="#ImageCodecInfo-帮助方法" class="headerlink" title="ImageCodecInfo 帮助方法"></a>ImageCodecInfo 帮助方法</h2><p>简写：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ImageCodecInfo <span class="title">GetEncoder</span>(<span class="params">ImageFormat format</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> codecs = ImageCodecInfo.GetImageDecoders();</span><br><span class="line">    <span class="keyword">return</span> codecs.FirstOrDefault(codec =&gt; codec.FormatID == format.Guid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原始</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ImageCodecInfo <span class="title">GetEncoder</span>(<span class="params">ImageFormat format</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ImageCodecInfo[] codecs = ImageCodecInfo.GetImageEncoders();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (ImageCodecInfo codec <span class="keyword">in</span> codecs)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (codec.FormatID == format.Guid)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> codec;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="编码及压缩"><a href="#编码及压缩" class="headerlink" title="编码及压缩"></a>编码及压缩</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Bitmap target = <span class="keyword">new</span> Bitmap(width, height);</span><br><span class="line"></span><br><span class="line"><span class="comment">// format and encoder</span></span><br><span class="line"><span class="comment">// the format is used by the encoder</span></span><br><span class="line"><span class="comment">// to generate ImageCodecInfo</span></span><br><span class="line">ImageFormat format = ImageFormat.Jpeg;</span><br><span class="line">ImageCodecInfo encoder = GetEncoder(format);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bitmap.Save takes the EncoderParameters,</span></span><br><span class="line"><span class="comment">// but what we make is a EncoderParameter, no &quot;s&quot; at the end.</span></span><br><span class="line"><span class="comment">// use EncoderParameters.Param[0] to assign</span></span><br><span class="line">EncoderParameters pm = <span class="keyword">new</span> EncoderParameters(<span class="number">1</span>);</span><br><span class="line">pm.Param[<span class="number">0</span>] = <span class="keyword">new</span> EncoderParameter(Encoder.Quality, <span class="number">80L</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> filename = ...</span><br><span class="line">target.Save(filename, encoder, pm);</span><br></pre></td></tr></table></figure>

<h2 id="附：裁剪图片"><a href="#附：裁剪图片" class="headerlink" title="附：裁剪图片"></a>附：裁剪图片</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Rectangle cropRect = <span class="keyword">new</span> Rectangle(x, y, width, height);</span><br><span class="line"></span><br><span class="line">Bitmap target = <span class="keyword">new</span> Bitmap(width, height);</span><br><span class="line">Graphics g = Graphics.FromImage(target);</span><br><span class="line">g.DrawImage(img, </span><br><span class="line">            <span class="keyword">new</span> Rectangle(<span class="number">0</span>, <span class="number">0</span>, target.Width, target.Height),</span><br><span class="line">            cropRect,</span><br><span class="line">            GraphicsUnit.Pixel);</span><br></pre></td></tr></table></figure>

</div></div><a class="button-hover more" href="/2025/01/25/csharp-images/#more">阅读全文</a></div><div class="recent-post-item"><a class="post-title" href="/2025/01/25/csharp-popups/">C# 弹窗获取文件等</a><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 更新于 2025-01-25</time><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/csharp/">csharp</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/csharp/">csharp</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/microsoft/">microsoft</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/dotnet/">dotnet</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/wpf/">wpf</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/winform/">winform</a></div></div><div class="post-content"><div class="main-content content"><h1 id="C-弹窗获取文件等"><a href="#C-弹窗获取文件等" class="headerlink" title="C#弹窗获取文件等"></a>C#弹窗获取文件等</h1><h2 id="Winform获取文件"><a href="#Winform获取文件" class="headerlink" title="Winform获取文件"></a>Winform获取文件</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件选取 这里只允许txt文件</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">button1_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    OpenFileDialog dialog = <span class="keyword">new</span> OpenFileDialog();</span><br><span class="line">    dialog.Multiselect = <span class="literal">false</span>;   <span class="comment">//是否允许多选</span></span><br><span class="line">    dialog.Title = <span class="string">&quot;请选择要处理的文件&quot;</span>;  <span class="comment">//窗口title</span></span><br><span class="line">    dialog.Filter = <span class="string">&quot;文本文件(*.txt)|*.*&quot;</span>;   <span class="comment">//可选择的文件类型</span></span><br><span class="line">    <span class="keyword">if</span> (dialog.ShowDialog() == System.Windows.Forms.DialogResult.OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> path = dialog.FileName;  <span class="comment">//获取文件路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Winform另存为"><a href="#Winform另存为" class="headerlink" title="Winform另存为"></a>Winform另存为</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SaveFileDialog savedialog = <span class="keyword">new</span> SaveFileDialog();</span><br><span class="line">savedialog.Filter = <span class="string">&quot;Jpg 图片|*.jpg|Bmp 图片|*.bmp|Gif 图片|*.gif|Png 图片|*.png|Wmf  图片|*.wmf&quot;</span>;</span><br><span class="line">savedialog.FilterIndex = <span class="number">0</span>;</span><br><span class="line">savedialog.RestoreDirectory = <span class="literal">true</span>;<span class="comment">//保存对话框是否记忆上次打开的目录</span></span><br><span class="line">savedialog.CheckPathExists = <span class="literal">true</span>;<span class="comment">//检查目录</span></span><br><span class="line">savedialog.FileName = System.DateTime.Now.ToString(<span class="string">&quot;yyyyMMddHHmmss&quot;</span>) + <span class="string">&quot;-&quot;</span>; ;<span class="comment">//设置默认文件名</span></span><br><span class="line"><span class="keyword">if</span> (savedialog.ShowDialog() == DialogResult.OK)</span><br><span class="line">&#123;</span><br><span class="line">    image.Save(savedialog.FileName, System.Drawing.Imaging.ImageFormat.Jpeg);<span class="comment">// image为要保存的图片</span></span><br><span class="line">    MessageBox.Show(<span class="keyword">this</span>, <span class="string">&quot;图片保存成功！&quot;</span>, <span class="string">&quot;信息提示&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="WPF获取文件-Win32"><a href="#WPF获取文件-Win32" class="headerlink" title="WPF获取文件(Win32)"></a>WPF获取文件(Win32)</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Microsoft.Win32.OpenFileDialog</span></span><br><span class="line"><span class="keyword">using</span> Microsoft.Win32;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ButtonBase_OnClick</span>(<span class="params"><span class="built_in">object</span> sender, RoutedEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> openFileDialog = <span class="keyword">new</span> OpenFileDialog();</span><br><span class="line">    <span class="keyword">if</span> (openFileDialog.ShowDialog() == <span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// do something with the filename</span></span><br><span class="line">        MessageBox.Show(openFileDialog.FileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also specify a filter, which will show only certain type of files, like this:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> openFileDialog = <span class="keyword">new</span> OpenFileDialog</span><br><span class="line">&#123;</span><br><span class="line">    Filter = <span class="string">&quot;Text files (*.txt)|*.txt|All files (*.*)|*.*&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="WPF另存为"><a href="#WPF另存为" class="headerlink" title="WPF另存为"></a>WPF另存为</h2><p>SaveFileDialog类位于PresentationFramework.dll 的Microsoft.Win32命名空间</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">ChooseSaveFile</span>(<span class="params"><span class="built_in">string</span> title,<span class="built_in">string</span> initFolder</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    SaveFileDialog dlg = <span class="keyword">new</span> SaveFileDialog();</span><br><span class="line">    dlg.Title = title;</span><br><span class="line">    dlg.FileName = <span class="string">&quot;User.txt&quot;</span>; <span class="comment">// Default file name</span></span><br><span class="line">    dlg.DefaultExt = <span class="string">&quot;.txt&quot;</span>; <span class="comment">// Default file extension</span></span><br><span class="line">    dlg.Filter = <span class="string">&quot;Text documents|*.txt&quot;</span>; <span class="comment">// Filter files by extension</span></span><br><span class="line">    dlg.InitialDirectory = initFolder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Process save file dialog box results</span></span><br><span class="line">    <span class="keyword">if</span> (dlg.ShowDialog() == <span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> dlg.FileName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="通用获取文件夹-Ookii"><a href="#通用获取文件夹-Ookii" class="headerlink" title="通用获取文件夹(Ookii)"></a>通用获取文件夹(Ookii)</h2><p>Another typical case is when you need the user to select a folder. This time a File Dialog won’t do the job and you’ll need something different. If you’ve ever used WinForms you’d probably know FolderBrowserDialog class. Unfortunately this is not available in WPF by default, but don’t worry, you can still solve this in at least 3 different ways:</p>
<ol>
<li>Add the System.Windows.Forms DLL and use the FolderBrowserDialog class</li>
<li>Install the <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Ookii.Dialogs/">Ookii.Dialogs nuget</a> and use the VistaFolderBrowserDialog class</li>
<li>Install the <a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Microsoft.WindowsAPICodePack-Shell">Windows API Code Pack-Shell</a> and use the CommonOpenFileDialog class</li>
</ol>
<p>The one I use the most is the Ookii.Dialogs one which looks easier and simpler to me. Just use this snippet and you’re ready to go:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ButtonBase2_OnClick</span>(<span class="params"><span class="built_in">object</span> sender, RoutedEventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> ookiiDialog = <span class="keyword">new</span> VistaFolderBrowserDialog();</span><br><span class="line">    <span class="keyword">if</span> (ookiiDialog.ShowDialog() == DialogResult.OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// do something with the folder path</span></span><br><span class="line">        MessageBox.Show(ookiiDialog.SelectedPath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></div><a class="button-hover more" href="/2025/01/25/csharp-popups/#more">阅读全文</a></div></div><div id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fas fa-angle-right"></i></a></div></div></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fas fa-user"></i></span><span id="busuanzi_value_site_uv"></span><span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fas fa-eye"></i></span><span id="busuanzi_value_site_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2025 By TaylorAndTony</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>